<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PDF to Images - ToolGenie</title>
  <link rel="stylesheet" href="css/style.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
</head>
<body>
  <div class="container">
    <h1 class="tool-title">PDF to Images</h1>
    <p class="tool-description">Convert PDF pages to images. Download all pages or select specific ones.</p>

    <div class="upload-area" id="drop-area">
      <p>Drag & drop your PDF file here or click to upload</p>
      <input type="file" id="fileElem" accept="application/pdf" />
    </div>

    <div id="fileInfo" class="file-list"></div>

    <div class="options" id="pageOptionSection" style="display:none;">
      <label for="pageNumbers">Enter pages (comma-separated, e.g., 1,3,5):</label>
      <input type="text" id="pageNumbers" placeholder="Leave blank for all pages" />
    </div>

    <button class="action-btn" onclick="convertPDFtoImages()">Convert</button>
    <div id="loader" class="loader" style="display: none;"></div>
    <div id="output" class="output-links"></div>
  </div>

  <script>
    let pdfFile = null;
    let pdfDoc = null;

    const dropArea = document.getElementById("drop-area");
    const fileElem = document.getElementById("fileElem");
    const fileInfo = document.getElementById("fileInfo");
    const output = document.getElementById("output");
    const loader = document.getElementById("loader");
    const pageOptionSection = document.getElementById("pageOptionSection");

    dropArea.addEventListener("click", () => fileElem.click());
    fileElem.addEventListener("change", (e) => handleFile(e.target.files[0]));

    dropArea.addEventListener("dragover", (e) => {
      e.preventDefault();
      dropArea.classList.add("highlight");
    });
    dropArea.addEventListener("dragleave", () => dropArea.classList.remove("highlight"));
    dropArea.addEventListener("drop", (e) => {
      e.preventDefault();
      dropArea.classList.remove("highlight");
      handleFile(e.dataTransfer.files[0]);
    });

    async function handleFile(file) {
      if (file.type === "application/pdf") {
        pdfFile = file;
        fileInfo.innerHTML = `<div>${file.name}</div>`;
        const fileReader = new FileReader();
        fileReader.onload = async function() {
          const typedarray = new Uint8Array(this.result);
          pdfDoc = await pdfjsLib.getDocument({ data: typedarray }).promise;
          pageOptionSection.style.display = "block";
        };
        fileReader.readAsArrayBuffer(file);
      } else {
        alert("Please upload a valid PDF file.");
      }
    }

    async function convertPDFtoImages() {
      if (!pdfDoc) return alert("Upload a PDF first.");

      loader.style.display = "block";
      output.innerHTML = "";

      let pageInput = document.getElementById("pageNumbers").value.trim();
      let pages = [];

      if (pageInput) {
        pages = pageInput.split(',').map(num => parseInt(num)).filter(n => !isNaN(n));
      } else {
        for (let i = 1; i <= pdfDoc.numPages; i++) pages.push(i);
      }

      for (let i = 0; i < pages.length; i++) {
        let pageNum = pages[i];
        if (pageNum < 1 || pageNum > pdfDoc.numPages) continue;

        const page = await pdfDoc.getPage(pageNum);
        const viewport = page.getViewport({ scale: 2 });

        const canvas = document.createElement("canvas");
        const context = canvas.getContext("2d");
        canvas.height = viewport.height;
        canvas.width = viewport.width;

        await page.render({ canvasContext: context, viewport: viewport }).promise;

        canvas.toBlob(blob => {
          const url = URL.createObjectURL(blob);
          const link = document.createElement("a");
          link.href = url;
          link.download = `page-${pageNum}.png`;
          link.textContent = `Download Page ${pageNum}`;
          link.className = "download-btn";
          output.appendChild(link);
        });
      }

      loader.style.display = "none";
    }
  </script>
</body>
</html>

