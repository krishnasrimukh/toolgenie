<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PDF Splitter - ToolGenie</title>
  <link rel="stylesheet" href="../css/style.css" />
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
</head>
<body>
  <div class="container">
    <h1 class="heading">✂️ PDF Splitter</h1>
    <p class="subheading">Split your PDF by page ranges or into equal parts</p>

    <div class="drop-area" id="drop-area">
      <p>Drag & Drop PDF here or <label for="fileElem" class="browse-label">Browse</label></p>
      <input type="file" id="fileElem" accept="application/pdf" style="display:none" />
    </div>

    <div id="options" class="tool-card hidden">
      <h3>Select Split Mode:</h3>
      <label><input type="radio" name="mode" value="range" checked> By page ranges (e.g., 1-2,4-6)</label><br>
      <label><input type="radio" name="mode" value="every"> Split every N pages</label><br>
      <label><input type="radio" name="mode" value="per"> Pages per split (each file has N pages)</label>

      <div id="rangeInput" class="input-group">
        <label>Ranges (comma separated):</label>
        <input type="text" id="rangeText" class="input" placeholder="e.g. 1-2,4-6" />
      </div>

      <div id="everyInput" class="input-group hidden">
        <label>Every N pages:</label>
        <input type="number" id="everyN" class="input" min="1" placeholder="e.g. 3" />
      </div>

      <div id="perInput" class="input-group hidden">
        <label>Pages per file:</label>
        <input type="number" id="perN" class="input" min="1" placeholder="e.g. 5" />
      </div>

      <div class="controls">
        <button class="button" onclick="splitPDF()">Split PDF</button>
      </div>
    </div>

    <div id="downloadSection" class="preview-container hidden"></div>
  </div>

  <script>
    const { PDFDocument } = PDFLib;
    let fileBytes = null;

    const dropArea = document.getElementById('drop-area');
    const fileElem = document.getElementById('fileElem');
    const options = document.getElementById('options');
    const downloadSection = document.getElementById('downloadSection');

    dropArea.addEventListener('dragover', e => { e.preventDefault(); dropArea.classList.add('dragover'); });
    dropArea.addEventListener('dragleave', () => dropArea.classList.remove('dragover'));
    dropArea.addEventListener('drop', e => { e.preventDefault(); dropArea.classList.remove('dragover'); handleFile(e.dataTransfer.files[0]); });
    fileElem.addEventListener('change', () => handleFile(fileElem.files[0]));

    document.querySelector('.browse-label').addEventListener('click', () => fileElem.click());

    function handleFile(file) {
      if (!file || file.type !== "application/pdf") return alert("Upload a PDF.");
      const reader = new FileReader();
      reader.onload = e => {
        fileBytes = e.target.result;
        options.classList.remove('hidden');
      };
      reader.readAsArrayBuffer(file);
    }

    // Toggle inputs
    document.getElementsByName('mode').forEach(r => r.addEventListener('change', () => {
      document.getElementById('rangeInput').classList.toggle('hidden', r.value !== 'range');
      document.getElementById('everyInput').classList.toggle('hidden', r.value !== 'every');
      document.getElementById('perInput').classList.toggle('hidden', r.value !== 'per');
    }));

    async function splitPDF() {
      if (!fileBytes) return alert("No PDF loaded.");
      const pdf = await PDFDocument.load(fileBytes);
      const totalPages = pdf.getPageCount();
      const mode = document.querySelector('input[name="mode"]:checked').value;

      let outputFiles = [];

      if (mode === 'range') {
        const ranges = document.getElementById('rangeText').value.split(',').map(r => r.trim());
        for (let r of ranges) {
          const [s, e] = r.split('-').map(Number);
          if (!s || !e || s>e || s<1 || e>totalPages) continue;
          const doc = await PDFDocument.create();
          for (let i=s-1; i<e; i++) {
            const [pg] = await doc.copyPages(pdf, [i]);
            doc.addPage(pg);
          }
          outputFiles.push({ name:`pages-${s}-to-${e}.pdf`, bytes: await doc.save() });
        }

      } else if (mode === 'every') {
        const N = parseInt(document.getElementById('everyN').value);
        if (!N || N < 1) return alert("Enter valid number.");
        for (let i=0; i<totalPages; i+=N) {
          const doc = await PDFDocument.create();
          const end = Math.min(i+N, totalPages);
          for (let j=i; j<end; j++) {
            const [pg] = await doc.copyPages(pdf, [j]);
            doc.addPage(pg);
          }
          outputFiles.push({ name:`pages-${i+1}-to-${end}.pdf`, bytes: await doc.save() });
        }

      } else if (mode === 'per') {
        const M = parseInt(document.getElementById('perN').value);
        if (!M || M < 1) return alert("Enter valid number.");
        let idx = 0, part = 1;
        while (idx < totalPages) {
          const doc = await PDFDocument.create();
          const end = Math.min(idx + M, totalPages);
          for (let j=idx; j<end; j++) {
            const [pg] = await doc.copyPages(pdf, [j]);
            doc.addPage(pg);
          }
          outputFiles.push({ name:`part-${part}.pdf`, bytes: await doc.save() });
          idx = end; part++;
        }
      }

      if (!outputFiles.length) return alert("No valid file chunks created.");

      downloadSection.innerHTML = '';
      for (let f of outputFiles) {
        const blob = new Blob([f.bytes], {type:'application/pdf'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = f.name;
        a.className = 'button blue-button';
        a.textContent = `Download: ${f.name}`;
        downloadSection.appendChild(a);
      }
      downloadSection.classList.remove('hidden');
    }
  </script>

  <style>
    .hidden { display:none; }
    .file-list, .input-group, .controls, .download-section {
      margin:1rem 0; text-align:center;
    }
    .input-group label {
      display:block; margin-bottom:6px; color:#333;
    }
    .browse-label { color: #007BFF; cursor:pointer; text-decoration:underline; }
  </style>
</body>
</html>
